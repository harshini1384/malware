from flask import Flask, request, jsonify
from flask_cors import CORS
import requests

app = Flask(__name__)
CORS(app)

# VirusTotal API Key
VIRUSTOTAL_API_KEY = 'd7db4ff77ef602465b2f8afed5110bc9a06aa6b441bb7ca3e1b012f423c7c047'

def check_with_virustotal(ip_or_url):
    url = "https://www.virustotal.com/vtapi/v2/url/report"
    params = {'apikey': VIRUSTOTAL_API_KEY, 'resource': ip_or_url}
    
    response = requests.get(url, params=params)
    result = response.json()

    if response.status_code == 200:
        if result['response_code'] == 1:
            if result['positives'] > 0:
                return f"{ip_or_url} is malicious with {result['positives']} detections."
            else:
                return f"{ip_or_url} is clean."
        else:
            return f"{ip_or_url} is malicious."
    else:
        return f"Error querying VirusTotal API: {response.status_code}"

@app.route('/check', methods=['POST'])
def check_malicious():
    data = request.get_json()
    ip_or_url = data.get('ipOrUrl')

    result_message = check_with_virustotal(ip_or_url)
    return jsonify({'message': result_message})

if __name__ == '__main__':
    app.run(debug=True)